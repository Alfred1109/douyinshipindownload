# 系统总览

## 🎯 项目概述

**抖音短视频文案提取工具** - 基于 FastAPI + Playwright 的智能视频文案提取系统

### 核心价值
- 🚀 **高效**: GPU 加速，5 分钟视频仅需 20 秒处理
- 🎯 **准确**: Whisper 语音识别 + LLM 增强，准确率 > 95%
- 🛡️ **可靠**: Playwright 浏览器自动化，完全绕过反爬
- 🔧 **易用**: Web 界面 + API，支持文件上传和 URL 提取

## 📊 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                          用户交互层                               │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  Web 界面    │  │  Swagger UI  │  │  命令行工具   │          │
│  │              │  │              │  │              │          │
│  │ • URL 提取   │  │ • API 测试   │  │ • 批量脚本   │          │
│  │ • 文件上传   │  │ • 文档查看   │  │ • 自动化     │          │
│  │ • Cookie管理 │  │ • 在线调试   │  │ • 集成测试   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                        FastAPI 路由层                             │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  主路由      │  │  上传路由    │  │  Cookie路由   │          │
│  │              │  │              │  │              │          │
│  │ /api/extract │  │ /api/upload  │  │ /api/cookies │          │
│  │ /api/batch   │  │              │  │              │          │
│  │ /api/task    │  │              │  │              │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                        Pipeline 编排层                            │
│                                                                   │
│  ┌───────────────────────────────────────────────────────┐      │
│  │              流水线编排 (pipeline.py)                   │      │
│  │                                                         │      │
│  │  • 任务创建与管理                                        │      │
│  │  • 进度跟踪与回调                                        │      │
│  │  • 并发控制 (Semaphore)                                 │      │
│  │  • 错误处理与重试                                        │      │
│  │  • 结果保存与清理                                        │      │
│  └───────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                        核心服务层                                 │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ 浏览器抓取   │  │  音频提取    │  │  语音识别    │          │
│  │              │  │              │  │              │          │
│  │ Playwright   │→ │   FFmpeg     │→ │   Whisper    │          │
│  │              │  │              │  │              │          │
│  │ • 启动浏览器 │  │ • MP4→MP3    │  │ • GPU 加速   │          │
│  │ • 加载Cookie │  │ • 音频优化   │  │ • 中文识别   │          │
│  │ • 拦截请求   │  │ • 格式转换   │  │ • 实时转写   │          │
│  │ • 下载视频   │  │              │  │              │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                              ↓                   │
│                          ┌──────────────────────┐               │
│                          │    LLM 增强          │               │
│                          │                      │               │
│                          │  DeepSeek API        │               │
│                          │                      │               │
│                          │  • 纠正错字          │               │
│                          │  • 添加标点          │               │
│                          │  • 优化断句          │               │
│                          │  • 保持原意          │               │
│                          └──────────────────────┘               │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                        基础设施层                                 │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  配置管理    │  │  文件系统    │  │  日志系统    │          │
│  │              │  │              │  │              │          │
│  │ • .env 配置  │  │ • temp/      │  │ • 结构化日志 │          │
│  │ • 环境变量   │  │ • output/    │  │ • 错误追踪   │          │
│  │ • 类型验证   │  │ • 自动清理   │  │ • 性能监控   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

## 🔄 数据流转图

```
┌─────────────┐
│  用户输入    │
│             │
│ • 视频 URL  │
│ • 视频文件  │
└──────┬──────┘
       │
       ↓
┌─────────────────────────────────────────────────────────┐
│  阶段 1: 视频获取 (10-30秒)                              │
│                                                           │
│  URL 模式:                    文件模式:                   │
│  ┌──────────────┐            ┌──────────────┐           │
│  │ Playwright   │            │ 文件上传     │           │
│  │ 启动浏览器   │            │ 保存到 temp  │           │
│  │ 访问页面     │            └──────────────┘           │
│  │ 拦截请求     │                                        │
│  │ 下载视频     │                                        │
│  └──────────────┘                                        │
│         ↓                            ↓                   │
│  temp/video_xxx.mp4          temp/uploaded_xxx.mp4      │
└─────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────────────────────────────────────────────────┐
│  阶段 2: 音频提取 (2-5秒)                                │
│                                                           │
│  ┌──────────────────────────────────────┐               │
│  │  FFmpeg 音频提取                      │               │
│  │                                       │               │
│  │  ffmpeg -i video.mp4 \                │               │
│  │         -vn \                         │               │
│  │         -acodec libmp3lame \          │               │
│  │         -q:a 2 \                      │               │
│  │         audio.mp3                     │               │
│  └──────────────────────────────────────┘               │
│                    ↓                                     │
│            temp/audio_xxx.mp3                            │
└─────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────────────────────────────────────────────────┐
│  阶段 3: 语音识别 (1-2秒 GPU / 60-300秒 CPU)            │
│                                                           │
│  ┌──────────────────────────────────────┐               │
│  │  Faster-Whisper 语音识别              │               │
│  │                                       │               │
│  │  • 模型: medium                       │               │
│  │  • 设备: CUDA (GTX 1060)              │               │
│  │  • 精度: float32                      │               │
│  │  • 语言: 中文                         │               │
│  │                                       │               │
│  │  性能: 868 字/秒                      │               │
│  └──────────────────────────────────────┘               │
│                    ↓                                     │
│            原始文案 (1649 字)                             │
│            无标点、可能有错字                             │
└─────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────────────────────────────────────────────────┐
│  阶段 4: LLM 增强 (3-5秒)                                │
│                                                           │
│  ┌──────────────────────────────────────┐               │
│  │  DeepSeek API 文案增强                │               │
│  │                                       │               │
│  │  • 纠正同音错字                       │               │
│  │    "百毒人" → "幕后主使"              │               │
│  │                                       │               │
│  │  • 添加标点符号                       │               │
│  │    逗号、句号、问号                   │               │
│  │                                       │               │
│  │  • 优化断句                           │               │
│  │    合理分段、提高可读性               │               │
│  │                                       │               │
│  │  • 保持原意                           │               │
│  │    不改变内容和风格                   │               │
│  └──────────────────────────────────────┘               │
│                    ↓                                     │
│            增强文案 (1806 字)                             │
│            有标点、已纠错、易阅读                         │
└─────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────────────────────────────────────────────────┐
│  阶段 5: 结果保存 (1秒)                                  │
│                                                           │
│  ┌──────────────────────────────────────┐               │
│  │  保存到 output/ 目录                  │               │
│  │                                       │               │
│  │  • JSON 格式 (完整数据)               │               │
│  │    - 任务信息                         │               │
│  │    - 视频信息                         │               │
│  │    - 原始文案                         │               │
│  │    - 增强文案                         │               │
│  │                                       │               │
│  │  • TXT 格式 (纯文本)                  │               │
│  │    - 标题                             │               │
│  │    - 作者                             │               │
│  │    - 链接                             │               │
│  │    - 文案内容                         │               │
│  └──────────────────────────────────────┘               │
└─────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────┐
│  返回结果    │
│             │
│ • 任务状态  │
│ • 文案内容  │
│ • 视频信息  │
└─────────────┘
```

## 🎨 技术栈全景

```
┌─────────────────────────────────────────────────────────────┐
│                        前端技术                               │
│                                                               │
│  HTML5 + CSS3 + Vanilla JavaScript                           │
│  • 响应式设计                                                 │
│  • 标签页切换                                                 │
│  • 文件拖拽上传                                               │
│  • 实时进度显示                                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                        后端框架                               │
│                                                               │
│  FastAPI 0.104+ (Python 3.8+)                                │
│  • 异步处理 (AsyncIO)                                         │
│  • 类型提示 (Type Hints)                                      │
│  • 自动文档 (Swagger/ReDoc)                                   │
│  • 数据验证 (Pydantic)                                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      浏览器自动化                             │
│                                                               │
│  Playwright 1.40+                                            │
│  • Chromium 浏览器                                            │
│  • 网络请求拦截                                               │
│  • Cookie 管理                                                │
│  • 无头模式                                                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      语音识别引擎                             │
│                                                               │
│  Faster-Whisper 1.0+ + PyTorch 2.5.1+cu121                   │
│  • OpenAI Whisper 优化版                                      │
│  • CTranslate2 加速                                           │
│  • CUDA 12.1 支持                                             │
│  • GPU 加速 (GTX 1060)                                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      音视频处理                               │
│                                                               │
│  FFmpeg                                                      │
│  • 格式转换                                                   │
│  • 音频提取                                                   │
│  • 编解码                                                     │
│  • 质量优化                                                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      大模型集成                               │
│                                                               │
│  OpenAI Python SDK 1.6+ (兼容 DeepSeek API)                  │
│  • Chat Completions API                                      │
│  • 异步调用                                                   │
│  • 错误重试                                                   │
│  • 流式响应                                                   │
└─────────────────────────────────────────────────────────────┘
```

## 📈 性能指标

### 处理速度对比

```
┌─────────────────────────────────────────────────────────────┐
│  5 分钟视频处理时间分解                                        │
│                                                               │
│  ┌──────────────────────────────────────────────────┐       │
│  │ 下载视频 (Playwright)        ████████░░  10-30s  │       │
│  └──────────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────────┐       │
│  │ 提取音频 (FFmpeg)            ██░░░░░░░░   2-5s   │       │
│  └──────────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────────┐       │
│  │ 语音识别 (Whisper GPU)       █░░░░░░░░░   1-2s   │       │
│  └──────────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────────┐       │
│  │ LLM 增强 (DeepSeek)          ███░░░░░░░   3-5s   │       │
│  └──────────────────────────────────────────────────┘       │
│  ┌──────────────────────────────────────────────────┐       │
│  │ 保存结果                     █░░░░░░░░░   < 1s   │       │
│  └──────────────────────────────────────────────────┘       │
│                                                               │
│  总计: 20-45 秒                                               │
└─────────────────────────────────────────────────────────────┘
```

### GPU vs CPU 性能对比

```
┌─────────────────────────────────────────────────────────────┐
│  Whisper 语音识别性能对比 (5分钟音频)                         │
│                                                               │
│  GPU 模式 (GTX 1060):                                         │
│  ████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  1.9 秒       │
│                                                               │
│  CPU 模式 (Intel i5):                                         │
│  ████████████████████████████████████████████  300 秒        │
│                                                               │
│  速度提升: 150-300 倍                                         │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 配置矩阵

### 推荐配置组合

| 场景 | 模型大小 | 设备 | 精度 | 并发 | 说明 |
|------|---------|------|------|------|------|
| 🚀 高性能 | medium | cuda | float32 | 3 | GTX 1060+ |
| ⚡ 平衡 | small | cuda | float32 | 2 | GTX 1050+ |
| 💻 CPU | small | cpu | int8 | 1 | 无 GPU |
| 🎯 高精度 | large | cuda | float32 | 1 | RTX 3060+ |
| 📱 低配置 | tiny | cpu | int8 | 1 | 最低要求 |

## 🎯 使用场景矩阵

```
┌─────────────────────────────────────────────────────────────┐
│  使用场景决策树                                               │
│                                                               │
│  需要提取视频文案？                                           │
│         │                                                     │
│         ├─ 有视频文件？                                       │
│         │      │                                              │
│         │      └─ YES → 使用文件上传 ⭐⭐⭐⭐⭐                │
│         │                • 最可靠                            │
│         │                • 无需 Cookie                       │
│         │                • 支持任意来源                      │
│         │                                                     │
│         └─ 只有 URL？                                         │
│                │                                              │
│                ├─ 公开视频？                                  │
│                │      │                                       │
│                │      └─ YES → URL 提取（无 Cookie）⭐⭐⭐⭐  │
│                │                • 自动化                     │
│                │                • 快速                       │
│                │                                              │
│                └─ 需要登录？                                  │
│                       │                                       │
│                       └─ YES → URL 提取（配置 Cookie）⭐⭐⭐  │
│                                 • 访问私密视频               │
│                                 • 高清视频                   │
│                                                               │
│  需要批量处理？                                               │
│         │                                                     │
│         └─ YES → 使用批量 API ⭐⭐⭐⭐                         │
│                  • 并发处理                                  │
│                  • 进度跟踪                                  │
│                  • 统一管理                                  │
└─────────────────────────────────────────────────────────────┘
```

## 📊 系统状态监控

### 健康检查指标

```
┌─────────────────────────────────────────────────────────────┐
│  系统健康状态                                                 │
│                                                               │
│  ✅ API 服务         [运行中]  http://localhost:8000         │
│  ✅ Playwright      [就绪]    Chromium 已安装                │
│  ✅ Whisper 模型    [已加载]  medium (1.5GB)                 │
│  ✅ GPU 加速        [可用]    GTX 1060 (6GB)                 │
│  ✅ LLM API         [已配置]  DeepSeek v3                    │
│  ✅ FFmpeg          [已安装]  版本 6.0                       │
│                                                               │
│  📊 资源使用                                                  │
│  • CPU:  15%  ████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░         │
│  • GPU:  0%   ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░         │
│  • 内存: 2.1GB ████████░░░░░░░░░░░░░░░░░░░░░░░░░░          │
│  • 磁盘: 45MB  ██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░          │
│                                                               │
│  📈 任务统计 (今日)                                           │
│  • 总任务: 12                                                 │
│  • 成功: 11 (92%)                                             │
│  • 失败: 1 (8%)                                               │
│  • 平均时长: 28 秒                                            │
└─────────────────────────────────────────────────────────────┘
```

## 🎓 学习路径

```
┌─────────────────────────────────────────────────────────────┐
│  从入门到精通                                                 │
│                                                               │
│  第 1 天: 快速上手                                            │
│  ├─ 安装依赖                                                  │
│  ├─ 配置环境                                                  │
│  ├─ 启动服务                                                  │
│  └─ 提取第一个视频                                            │
│                                                               │
│  第 2-3 天: 深入理解                                          │
│  ├─ 阅读架构文档                                              │
│  ├─ 理解处理流程                                              │
│  ├─ 尝试不同配置                                              │
│  └─ 批量处理实践                                              │
│                                                               │
│  第 4-7 天: 高级应用                                          │
│  ├─ 性能优化                                                  │
│  ├─ 自定义配置                                                │
│  ├─ API 集成                                                  │
│  └─ 故障排查                                                  │
│                                                               │
│  第 2 周: 扩展开发                                            │
│  ├─ 阅读源代码                                                │
│  ├─ 添加新功能                                                │
│  ├─ 性能调优                                                  │
│  └─ 生产部署                                                  │
└─────────────────────────────────────────────────────────────┘
```

## 📚 文档导航

```
📁 项目文档
├── 📄 README.md                  快速开始指南
├── 📄 ARCHITECTURE.md            系统架构详解 (16KB)
├── 📄 TECH_STACK.md              技术栈说明 (8KB)
├── 📄 QUICK_REFERENCE.md         快速参考手册 (7KB)
├── 📄 SYSTEM_OVERVIEW.md         系统总览 (本文档)
└── 📄 PLAYWRIGHT_方案.md         Playwright 详解

🌐 在线文档
├── 🔗 http://localhost:8000/docs      Swagger UI
└── 🔗 http://localhost:8000/redoc     ReDoc

💻 代码文档
├── 📁 app/                            应用代码
│   ├── 📁 api/                       API 路由
│   ├── 📁 services/                  核心服务
│   ├── 📁 models/                    数据模型
│   └── 📁 utils/                     工具函数
└── 📁 web/                            Web 界面
```

## 🎯 核心优势

### 1. 技术优势
- ✅ **完全绕过反爬**: Playwright 模拟真实浏览器
- ✅ **GPU 加速**: 150-300 倍速度提升
- ✅ **LLM 增强**: 自动纠错和优化
- ✅ **异步处理**: 高并发支持

### 2. 功能优势
- ✅ **多种输入**: URL + 文件上传
- ✅ **批量处理**: 并发任务管理
- ✅ **Cookie 管理**: Web 界面配置
- ✅ **结果保存**: JSON + TXT 双格式

### 3. 用户体验
- ✅ **Web 界面**: 简洁易用
- ✅ **API 文档**: 自动生成
- ✅ **实时进度**: 状态跟踪
- ✅ **错误提示**: 友好反馈

### 4. 可维护性
- ✅ **模块化设计**: 清晰分层
- ✅ **类型安全**: Type Hints
- ✅ **配置管理**: .env 文件
- ✅ **日志系统**: 结构化日志

## 🚀 未来规划

### 短期 (1-3 个月)
- [ ] 支持更多视频平台
- [ ] 实时字幕生成
- [ ] 视频摘要功能
- [ ] 批量导出优化

### 中期 (3-6 个月)
- [ ] 多语言支持
- [ ] 云端部署
- [ ] 用户系统
- [ ] 任务队列

### 长期 (6-12 个月)
- [ ] 移动端应用
- [ ] 实时协作
- [ ] AI 视频分析
- [ ] 企业版功能

---

**最后更新**: 2026-02-16  
**版本**: 1.0.0  
**维护者**: 项目团队
